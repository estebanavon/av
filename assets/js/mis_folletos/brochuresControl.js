
var data1 = []
var data2 = []
var data3 = []
var data4 = []
var data5 = []
var data6 = []
var data7 = []
var data8 = []
var data9 = []
var data10 = []
var data11 = []
var data12 = []
var data13 = []
var data19 = []
var data20 = []
var data14 = []

var data15 = [
    [
            {
         title: 'Belleza',
         file: 'BellezaMx15.pdf',
         type: 'imb',
       },
       {
           title: 'Fashion & Home',
           file: 'FashionNHomeMx15.pdf',
           type: 'imb',
       },
       {
           title: 'Minifolleto Rostro 15',
           file: 'minifolletoRostro15.pdf',
           type: 'imb',
       },
       {
           title: 'Avon Contigo',
           file: 'avon_contigo_c1521.pdf',
           type: 'contigo',
       },
       {
           title: 'Minifolleto Higiene',
           file: 'avonHigiene14-16.pdf',
           type: 'imb',
       },
       {
           title: 'EcoBeauty',
           file: 'Ecobeautyc11_c15.pdf',
           type: 'imb',
       },
       {
           title: 'Grandes Ofertas C15',
           file: 'grandesOfertasC15.pdf',
           type: 'flyer',
       },
       {
           title: 'Oferta Anticipada Navidad',
           file: 'flyerOfertaAnticipadaNavidad.pdf',
           type: 'flyer',
       },
       {
           title: 'Tendencias maquillaje',
           file: 'tendenciasMaquillajeC15.pdf',
           type: 'imb',
       },
    ],
    [
            {
             title: 'Belleza',
             file: 'BellezaMx15.pdf',
             type: 'imb',
         },
         {
             title: 'Fashion & Home',
             file: 'FashionNHomeMx15.pdf',
             type: 'imb',
         },
         {
             title: 'Avon Contigo',
             file: 'avon_contigo_c1521_ncm.pdf',
             type: 'contigo',
         },
         {
             title: 'Tendencias maquillaje',
             file: 'tendenciasMaquillajeC15.pdf',
             type: 'imb',
         },
    ]
 ]
 
 
 

 var data16 = [
    [
      {
        title: 'Belleza',
        file: 'BellezaMx16.1.pdf',
        type: 'imb',
      },
      {
          title: 'Fashion & Home',
          file: 'FashionNHomeMx16.pdf',
          type: 'imb',
      },
      {
          title: 'Avon Contigo',
          file: 'avon_contigo_c1621.pdf',
          type: 'contigo',
      },
      {
          title: 'Back to school C16',
          file: 'backToSchoolC16.pdf',
          type: 'flyer',
      },
      {
          title: 'DOP Navidad',
          file: 'DOPNavidad21.pdf',
          type: 'flyer',
      },
      {
          title: 'Minifolleto Bcos C16-19',
          file: 'folletoBco4qC16_19.pdf',
          type: 'imb',
      },
      {
          title: 'VEA físico Anew',
          file: 'veaFisicoAnewC18.pdf',
          type: 'flyer',
      },
      {
          title: 'Minifolleto Higiene',
          file: 'avonHigiene14-16.pdf',
          type: 'imb',
      },
      {
          title: 'Ofertas Patrias',
          file: 'OfertasPatriasC16.pdf',
          type: 'imb',
      },
    ],
    [
      {
        title: 'Belleza',
        file: 'BellezaMx16.1.pdf',
        type: 'imb',
      },
      {
          title: 'Fashion & Home',
          file: 'FashionNHomeMx16.pdf',
          type: 'imb',
      },
      {
          title: 'Avon Contigo',
          file: 'avon_contigo_c1621_ncm.pdf',
          type: 'contigo',
      },
      {
          title: 'Minifolleto Higiene',
          file: 'avonHigiene14-16.pdf',
          type: 'imb',
      },
      {
          title: 'DOP Navidad',
          file: 'DOPNavidad21Berilio.pdf',
          type: 'flyer',
      },
      {
          title: 'Venta Anticipada c16',
          file: 'flyerC16.pdf',
          type: 'flyer',
      },
      {
          title: 'Minifolleto Bcos C16-19',
          file: 'folletoBco4qC16_19.pdf',
          type: 'imb',
      },
      {
        title: 'Ofertas Patrias',
        file: 'OfertasPatriasC16.pdf',
        type: 'imb',
     },
    ]
]

var  data17 = [
    [
        {
            title: 'Belleza',
            file: 'BellezaMx17.pdf',
            type: 'imb',
        },
        {
            title: 'Fashion & Home',
            file: 'FashionNHomeMx17.pdf',
            type: 'imb',
        },
        
        {
            title: 'Avon Contigo',
            file: 'avon_contigo_c1721.pdf',
            type: 'contigo',
        },
        {
            title: 'Minifolleto Bcos C16-19',
            file: 'folletoBco4qC16_19.pdf',
            type: 'imb',
        },
        {
            title: 'Avon Dulces Ofertas C17-18',
            file: 'AvonDulcesOfertasC17_18.pdf',
            type: 'imb',
        },
        {
            title: 'Rostro C17 MX',
            file: 'RostroC1721MX.pdf',
            type: 'imb',
        },
        {
            title: 'Bazar 17',
            file: 'Bazar17Mx.pdf',
            type: 'bazar',
        },
    ],
    [
        {
            title: 'Belleza',
            file: 'BellezaMx17.pdf',
            type: 'imb',
        },
        {
            title: 'Fashion & Home',
            file: 'FashionNHomeMx17.pdf',
            type: 'imb',
        },
        {
            title: 'Avon Contigo',
            file: 'avon_contigo_c1721_ncm.pdf',
            type: 'contigo',
        },
        {
            title: 'Minifolleto Bcos C16-19',
            file: 'folletoBco4qC16_19.pdf',
            type: 'imb',
        },
        {
            title: 'Rostro C17 MX',
            file: 'RostroC1721MX.pdf',
            type: 'imb',
        },
        {
            title: 'Adelantos Navideñoos 2021 Ncm',
            file: 'AdelantosNavidenos2021Ncm.pdf',
            type: 'flyer',
        },
        {
            title: 'Avon Dulces Ofertas C17-18 Ncm',
            file: 'AvonDulcesOfertasC17_18NCM_Berilio.pdf',
            type: 'imb',
        },
        {
            title: 'Ofertas Ncm C17-18 Actividad',
            file: 'OfertasNcmC17_18Actividad.pdf',
            type: 'flyer',
        },
        {
            title: 'Bazar 17',
            file: 'Bazar17Mx.pdf',
            type: 'bazar',
        },
    ],
    
]
var  data18 = [
    [
        {
            title: 'Belleza',
            file: 'BellezaMx18.pdf',
            type: 'imb',
        },
        {
            title: 'Fashion & Home',
            file: 'FashionNHomeMx18.pdf',
            type: 'imb',
        },
        {
          title: 'Avon Contigo',
          file: 'avon_contigo_c1821.pdf',
          type: 'contigo',
        },
        {
            title: 'Rostro C18 MX',
            file: 'RostroC1821MX.pdf',
            type: 'imb',
        },
    ],
    [
        {
            title: 'Belleza',
            file: 'BellezaMx18.pdf',
            type: 'imb',
        },
        {
            title: 'Fashion & Home',
            file: 'FashionNHomeMx18.pdf',
            type: 'imb',
        },
        {
            title: 'Avon Contigo',
            file: 'avon_contigo_c1821_ncm.pdf',
            type: 'contigo',
          },
          {
            title: 'Rostro C18 MX',
            file: 'RostroC1821MX.pdf',
            type: 'imb',
        },
    ],
    
]


try{ 
    var c = AvonAnalyticsObjex.Profile.campaignInfo;
    //var c = '2021:C17';
    const currentCampaign = parseInt(c.slice(6), 10);
    const currentYear = c.slice(2,4);
    
    const avMarket = AvonAnalyticsObjex.Visitor.market;
    // const avMarket = 'mx';
    
    var d = AvonAnalyticsObjex.Profile.zone;
    var zm = AvonAnalyticsObjex.Profile.repAcct;
    //var d = '271';
    //var zm = '1'
    var avNcmBoolean,brochuresWrapper,masterHtml;
    avNcmBoolean = 0;
    
    var NCMzone = [
        '2700','2701','2702','2703','2704','2705','2706','2707','2708','2709','2710',
    ];
    if (NCMzone.includes(d) || zm == '888888827') {
        avNcmBoolean = 1;
    }

    brochuresWrapper = [data1[avNcmBoolean],data2[avNcmBoolean],data3[avNcmBoolean],data4[avNcmBoolean],data5[avNcmBoolean],data6[avNcmBoolean],data7[avNcmBoolean],data8[avNcmBoolean],data9[avNcmBoolean],data10[avNcmBoolean],data11[avNcmBoolean],data12[avNcmBoolean],data13[avNcmBoolean],data14[avNcmBoolean],data15[avNcmBoolean],data16[avNcmBoolean],data17[avNcmBoolean],data18[avNcmBoolean],data19[avNcmBoolean],data20[avNcmBoolean]];
    

    var brochuresConstructor = [brochuresWrapper[currentCampaign],brochuresWrapper[currentCampaign - 1],brochuresWrapper[currentCampaign - 2]];
    var brochurePrint = ["","","","","",""];




    function campaignSelector(e){
        let campaignSelected;
        switch (e) {
            case 0:
                campaignSelected = currentCampaign + 1;
                break
            case 1:
                campaignSelected = currentCampaign;
                break
            default:
                campaignSelected = currentCampaign - 1;
        }
        return campaignSelected
    }
    

    
    function copyText(type){
        let copyText;
        if (type == "imb" || type == "contigo"){
            copyText = 'Copiar link';
        } else {
            copyText = '¡Recuerda que es solo para ti!';
        }
        return copyText
    }


    function urlFile(type,file){
        let urlFile;
        switch (type){
            case "contigo":
                urlFile = 'https://qaf.'+ avMarket.toLowerCase() +'.avon.com/FLDSuite/static/pdf/incentivos2019/' + file
                break
            default:
                urlFile = 'https://qaf.'+ avMarket.toLowerCase() +'.avon.com/FLDSuite/static/pdf/mis_folletos/' + file
        }
        return urlFile
    }
    

    var canvasIdNumber,canvasID,_PDF_DOC,folder;

    function pdfImg(type,canvasIdNumber,file){
        let avCanvasLet;
        avCanvasLet = '<div class="av-canvas-container"><canvas width="132" class="av-canvas" id="avCanvas'+ canvasIdNumber +'"></canvas></div>'
        canvasID = '#avCanvas' + canvasIdNumber;
        
        if (type == 'contigo'){
            folder = 'incentivos2019'
        } else {
            folder = 'mis_folletos'
        }  
        showPDF('https://qaf.'+ avMarket.toLowerCase() +'.avon.com/FLDSuite/static/pdf/'+ folder +'/'+ file +'',canvasID);

        return avCanvasLet
    }


    async function showPDF(pdf_url,canvasID) {
        try {
            _PDF_DOC = await pdfjsLib.getDocument({ url: pdf_url });
        }
        catch(error) {
           // alert(error.message);
        }
        showPage(canvasID);
    }
    async function showPage(canvasID) {
        try {
            var page = await _PDF_DOC.getPage(1);
        }
        catch(error) {
           // alert(error.message);
        }
        var pdf_original_width = page.getViewport(1).width;
        var scale_required = 132 / pdf_original_width;
        var viewport = page.getViewport(scale_required);
        var render_context = {
            canvasContext: document.querySelector(canvasID).getContext('2d'),
            viewport: viewport
        };
        try {
            await page.render(render_context);
        }
        catch(error) {
            alert(error.message);
        }

    }
    
    var e = 0;
    var i;
    while (e < brochuresConstructor.length) {
        switch (e){
            case 0:
            case 1:
                for (i=0;i<brochuresConstructor[e].length;i++){
                    canvasIdNumber = campaignSelector(e) + '_' +i;
                    
                    brochurePrint[e] += '<div class="av-brochure-item" data-type="'+ brochuresConstructor[e][i].type +'">'+
                        '<div class="av-brochure-image">' + pdfImg(brochuresConstructor[e][i].type,canvasIdNumber,brochuresConstructor[e][i].file) +
                            '<div class="av-copy av-tooltip"><span class="material-icons">content_copy</span><div class="tooltiptext">'+ copyText(brochuresConstructor[e][i].type) +'</div></div>' +
                            '<input type="text" class="av-hidden" value="'+ urlFile(brochuresConstructor[e][i].type,brochuresConstructor[e][i].file) + '" />' +
                            '<a class="av-overlay" href="'+ urlFile(brochuresConstructor[e][i].type,brochuresConstructor[e][i].file) + '" target="_blank"><p class="material-icons">visibility</p><p>Ver</p></a>' +
                            '<div class="av-type '+ brochuresConstructor[e][i].type +'">'+ campaignSelector(e) +'</div>' +
                        '</div>' +
                        '<div class="av-brochure-text"><h3 class="av-brochure-title">'+ brochuresConstructor[e][i].title +'</h3></div>'+
                    '</div>'
                }
                break;
            case 2:
                for (i=0;i<brochuresConstructor[e].length;i++){
                    
                    brochurePrint[e] += '<li data-type="'+ brochuresConstructor[e][i].type  +'"><span class="av-type '+  brochuresConstructor[e][i].type  +'"></span>' +
                    '<span>'+ brochuresConstructor[e][i].title + ' C'+ campaignSelector(2) +'</span>' +
                    '<span class="av-list-spacer"></span>' +
                    '<a class="av-button-icon av-tooltip" href="'+ urlFile(brochuresConstructor[e][i].type,brochuresConstructor[e][i].file) +'" target="_blank">' +
                    '<span class="material-icons">visibility</span><div class="tooltiptext">Ver</div></a>' +
                    '<div class="av-button-icon av-copy av-tooltip"><span class="material-icons">content_copy</span><div class="tooltiptext">'+ copyText(brochuresConstructor[e][i].type) +'</div></div>' +
                    '<input type="text" class="av-hidden" value="'+ urlFile(brochuresConstructor[e][i].type,brochuresConstructor[e][i].file) +'" />' +
                    '</li>'
                }
                break;
        }
        e++
    };
    brochurePrint[3] += '<div class="av-brochure-item av-brochure-main" data-type="'+ brochuresConstructor[0][0].type +'">'+
                            '<div style="background-image:url(\'/FLDSuite/static/images/mis_folletos/brochureCover'+ (currentCampaign + 1) +'.jpg\')" class="av-brochure-image">' +
                                '<a class="av-overlay" href="'+ urlFile(brochuresConstructor[0][0].type,0,brochuresConstructor[0][0].file) + '" target="_blank"><p class="material-icons">visibility</p><p>Ver</p></a>' +
                                '<div class="av-type '+ brochuresConstructor[0][0].type +'">'+ (currentCampaign + 1) +'</div>' +
                            '</div>' +
                            '<div class="av-brochure-text"><h3 class="av-brochure-title">'+ brochuresConstructor[0][0].title +'</h3></div>' +
                        '</div>'
    brochurePrint[4] += currentCampaign;
    brochurePrint[5] += currentCampaign - 1;
    masterHtml = '<section class="av-lw"><aside id="brochureAside" class="av-brochure-aside"><div class="av-share"><div><i class="fas fa-share" aria-hidden="true"></i><span>Comparte</span></div><div><a href="mailto:subject=Este es mi Catálogo para ti"><i class="far fa-envelope" aria-hidden="true"></i></a><a style="margin: 0 20px;" href="https://www.facebook.com/" target="_blank"><i class="fab fa-facebook-f" aria-hidden="true"></i></a><a href="https://api.whatsapp.com/send?text=Este es mi Catálogo para ti" target="_blank"><i class="fab fa-whatsapp" aria-hidden="true"></i></a></div></div><div class="av-map"><div class=""><span class="material-icons">bookmark_border</span><span>Flyers / Minifolletos</span></div><div class=""><span class="material-icons">insert_drive_file</span><span>Catálogo Avon Móvil</span></div><div><span class="material-icons">description</span></svg><span>Bazar</span></div><div class=""><span class="material-icons">import_contacts</span><span>Avon Contigo</span></div></div></aside><section class="av-section-container expand"><h2 class="av-brochure-title"><span class="av-title-stroke">Mis</span> folletos</h2><div class="av-filtros" id="avFiltros"><div class="filter-all" data-filter="all">TODOS</div><div class="no-active flyer av-tooltip" data-filter="flyer"><span class="material-icons">bookmark_border</span><span class="tooltiptext">Flyers / Minifolletos</span></div><div class="no-active imb av-tooltip" data-filter="imb"><span class="material-icons">insert_drive_file</span><span class="tooltiptext">Catálogo Avon Móvil</span></div><div class="no-active bazar av-tooltip" data-filter="bazar"><span class="material-icons">description</span><span class="tooltiptext">Bazar</span></div><div class="no-active contigo av-tooltip" data-filter="contigo"><span class="material-icons">import_contacts</span><span class="tooltiptext">Avon Contigo</span></div></div><h3 style="margin-top:30px;display:flex;font-family: montserrat-bold, Gadget, sans-serif;text-transform: uppercase;font-size: 18px;" class="w-100 av-brochures-subtitle"><span class="material-icons">campaign</span> Campaña </h3><div class="av-brochures-container" id="brochureContainer"></div><h3 style="display:flex;font-family: montserrat-bold, Gadget, sans-serif;text-transform: uppercase;font-size: 18px;" class="w-100 av-brochures-subtitle"><span class="material-icons">campaign</span> Campaña </h3><div class="av-brochures-container" style="display:flex;" id="brochureContainerPast"></div><div class="av-brochures-container" id="brochureList"><ul class="av-list av-list-item w-100"></ul></div><button class="av-button-primary av-brochure-button" id="viewMore" style="display:block;">Consultar campaña previa</button></section></section>'
} catch {
    masterHtml = '<section class="av-lw"><aside class="av-brochure-aside"></aside><section class="av-section-container expand"><h2 class="av-brochure-title"><span class="av-title-stroke">Mis</span> folletos</h2><h1 style="padding:40px;font-size:40px;line-height: 42px;">Disculpa las molestias, por el momento no tenemos folletos disponibles. <br /><br />Intenta más tarde o intenta otro navegador.</h1></section>';
}

$(document).ready(function(){
    
    $('#avContaner').append(masterHtml)
    $('#brochureContainer').prepend(brochurePrint[0]).prev().append(parseInt(brochurePrint[4], 10) + 1);
    $('#brochureContainerPast').append(brochurePrint[1]).prev().append(brochurePrint[4]);
    $('#brochureAside').prepend(brochurePrint[3]);

    $('#viewMore').click(function(){
        $('#brochureList').css('display','flex').prepend('<h3 class="w-100 av-brochures-subtitle" style="display:flex;font-family: montserrat-bold, Gadget, sans-serif;text-transform: uppercase;font-size: 18px;"><span class="material-icons">campaign</span> Campaña '+ brochurePrint[5] +'</h3>');
        $('#brochureList ul').append(brochurePrint[2]);
        $(this).hide();
        avCopy();
    });
    avCopy();

    function avCopy (){
        $('.av-copy').click(function(){
            $(this).next().select();
            document.execCommand("copy");
            $(this).find('.tooltiptext').text('¡Copiado al portapapeles!');
            $(this).mouseleave(function(){
                $(this).find('.tooltiptext').text('Copiar link');  
            })
        });
    };

    const brochureSelector = $('#brochureContainer,#brochureContainerPast,#brochureList ul');
    $('#avFiltros').children().click(function(){
        let avFilter = $(this).attr('data-filter');
        $(this).removeClass('no-active').siblings().addClass('no-active');
        brochureSelector.children().show();
        if (avFilter != "all"){
            brochureSelector.children(':not([data-type="'+ avFilter +'"])').hide();
        }
    });

})